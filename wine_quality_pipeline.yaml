# PIPELINE DEFINITION
# Name: wine-quality-pipeline
# Description: A pipeline that ingests, splits, and trains three models in parallel.
# Inputs:
#    data_bucket: str [Default: 'yannick-wine-data']
components:
  comp-data-ingestion-op:
    executorLabel: exec-data-ingestion-op
    inputDefinitions:
      parameters:
        blob_name:
          parameterType: STRING
        bucket_name:
          parameterType: STRING
    outputDefinitions:
      artifacts:
        raw_dataset:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
  comp-train-model-op:
    executorLabel: exec-train-model-op
    inputDefinitions:
      artifacts:
        training_data:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
      parameters:
        image_name:
          parameterType: STRING
    outputDefinitions:
      artifacts:
        model_artifact:
          artifactType:
            schemaTitle: system.Model
            schemaVersion: 0.0.1
  comp-train-model-op-2:
    executorLabel: exec-train-model-op-2
    inputDefinitions:
      artifacts:
        training_data:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
      parameters:
        image_name:
          parameterType: STRING
    outputDefinitions:
      artifacts:
        model_artifact:
          artifactType:
            schemaTitle: system.Model
            schemaVersion: 0.0.1
  comp-train-model-op-3:
    executorLabel: exec-train-model-op-3
    inputDefinitions:
      artifacts:
        training_data:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
      parameters:
        image_name:
          parameterType: STRING
    outputDefinitions:
      artifacts:
        model_artifact:
          artifactType:
            schemaTitle: system.Model
            schemaVersion: 0.0.1
  comp-train-test-splitter-op:
    executorLabel: exec-train-test-splitter-op
    inputDefinitions:
      artifacts:
        input_dataset:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
    outputDefinitions:
      artifacts:
        testing_data:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
        training_data:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
deploymentSpec:
  executors:
    exec-data-ingestion-op:
      container:
        args:
        - --bucket-name
        - '{{$.inputs.parameters[''bucket_name'']}}'
        - --blob-name
        - '{{$.inputs.parameters[''blob_name'']}}'
        - --output-dataset-path
        - '{{$.outputs.artifacts[''raw_dataset''].path}}'
        command:
        - python3
        - component.py
        image: europe-west4-docker.pkg.dev/data-engineering-vm/yannick-wine-repo/data-ingestion:latest
    exec-train-model-op:
      container:
        args:
        - --training_data_path
        - '{{$.inputs.artifacts[''training_data''].path}}'
        - --model_artifact_path
        - '{{$.outputs.artifacts[''model_artifact''].path}}'
        command:
        - python3
        - component.py
        image: europe-west4-docker.pkg.dev/data-engineering-vm/yannick-wine-repo/{{$.inputs.parameters['image_name']}}:latest
    exec-train-model-op-2:
      container:
        args:
        - --training_data_path
        - '{{$.inputs.artifacts[''training_data''].path}}'
        - --model_artifact_path
        - '{{$.outputs.artifacts[''model_artifact''].path}}'
        command:
        - python3
        - component.py
        image: europe-west4-docker.pkg.dev/data-engineering-vm/yannick-wine-repo/{{$.inputs.parameters['image_name']}}:latest
    exec-train-model-op-3:
      container:
        args:
        - --training_data_path
        - '{{$.inputs.artifacts[''training_data''].path}}'
        - --model_artifact_path
        - '{{$.outputs.artifacts[''model_artifact''].path}}'
        command:
        - python3
        - component.py
        image: europe-west4-docker.pkg.dev/data-engineering-vm/yannick-wine-repo/{{$.inputs.parameters['image_name']}}:latest
    exec-train-test-splitter-op:
      container:
        args:
        - --input-dataset-path
        - '{{$.inputs.artifacts[''input_dataset''].path}}'
        - --training-data-path
        - '{{$.outputs.artifacts[''training_data''].path}}'
        - --testing-data-path
        - '{{$.outputs.artifacts[''testing_data''].path}}'
        command:
        - python3
        - component.py
        image: europe-west4-docker.pkg.dev/data-engineering-vm/yannick-wine-repo/train-test-splitter:latest
pipelineInfo:
  description: A pipeline that ingests, splits, and trains three models in parallel.
  name: wine-quality-pipeline
root:
  dag:
    tasks:
      data-ingestion-op:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-data-ingestion-op
        inputs:
          parameters:
            blob_name:
              runtimeValue:
                constant: raw/WineQT.csv
            bucket_name:
              componentInputParameter: data_bucket
        taskInfo:
          name: data-ingestion-op
      train-model-op:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-train-model-op
        dependentTasks:
        - train-test-splitter-op
        inputs:
          artifacts:
            training_data:
              taskOutputArtifact:
                outputArtifactKey: training_data
                producerTask: train-test-splitter-op
          parameters:
            image_name:
              runtimeValue:
                constant: model-trainer-dt
        taskInfo:
          name: Train-Decision-Tree
      train-model-op-2:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-train-model-op-2
        dependentTasks:
        - train-test-splitter-op
        inputs:
          artifacts:
            training_data:
              taskOutputArtifact:
                outputArtifactKey: training_data
                producerTask: train-test-splitter-op
          parameters:
            image_name:
              runtimeValue:
                constant: model-trainer-lr
        taskInfo:
          name: Train-Linear-Regression
      train-model-op-3:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-train-model-op-3
        dependentTasks:
        - train-test-splitter-op
        inputs:
          artifacts:
            training_data:
              taskOutputArtifact:
                outputArtifactKey: training_data
                producerTask: train-test-splitter-op
          parameters:
            image_name:
              runtimeValue:
                constant: model-trainer-logr
        taskInfo:
          name: Train-Logistic-Regression
      train-test-splitter-op:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-train-test-splitter-op
        dependentTasks:
        - data-ingestion-op
        inputs:
          artifacts:
            input_dataset:
              taskOutputArtifact:
                outputArtifactKey: raw_dataset
                producerTask: data-ingestion-op
        taskInfo:
          name: train-test-splitter-op
  inputDefinitions:
    parameters:
      data_bucket:
        defaultValue: yannick-wine-data
        isOptional: true
        parameterType: STRING
schemaVersion: 2.1.0
sdkVersion: kfp-2.14.6
