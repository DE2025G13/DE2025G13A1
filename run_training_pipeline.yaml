steps:
  - name: "python:3.9-slim"
    id: "CompilePipeline"
    entrypoint: "bash"
    args:
      - "-c"
      - |
        pip install google-cloud-aiplatform kfp
        python3 pipeline.py
  - name: "gcr.io/cloud-builders/gcloud"
    id: "RunTrainingPipeline"
    entrypoint: "bash"
    args:
      - "-c"
      - |
        gcloud beta ai pipelines run \
          --project=${PROJECT_ID} \
          --region=europe-west4 \
          --template-path=wine_quality_pipeline_git_triggered.yaml \
          --display-name=data-triggered-run-${SHORT_SHA} \
          --pipeline-root=gs://yannick-pipeline-root \
          --service-account=793868790421-compute@developer.gserviceaccount.com \
          --enable-caching=false
    waitFor: ["CompilePipeline"]