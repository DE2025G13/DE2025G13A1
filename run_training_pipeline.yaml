steps:
  - name: "python:3.9-slim"
    id: "CompilePipeline"
    entrypoint: "bash"
    args:
      - "-c"
      - |
        pip install google-cloud-aiplatform kfp
        python3 pipeline.py
  - name: "python:3.9-slim"
    id: "RunTrainingPipeline"
    entrypoint: "bash"
    args:
      - "-c"
      - |
        pip install 'google-cloud-aiplatform[pipelines]' --break-system-packages
        python3 -c "
        from google.cloud import aiplatform
        
        aiplatform.init(project='${PROJECT_ID}', location='europe-west4')
        
        job = aiplatform.PipelineJob(
            display_name='data-triggered-run-${SHORT_SHA}',
            template_path='wine_quality_pipeline_git_triggered.yaml',
            pipeline_root='gs://daan-pipeline-root',
            enable_caching=False
        )
        
        job.submit(service_account='949184088608-compute@developer.gserviceaccount.com')
        print(f'Pipeline submitted: {job.resource_name}')
        "
    waitFor: ["CompilePipeline"]